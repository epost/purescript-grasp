<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:foo="http://www.w3.org/2000/svg">
  <head>
    <meta charset="utf-8"/>
    <title>epost/purescript-grasp</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div id="grid">
      <div class="columns">
        <div class="column">
          <h1 class="title">grasp</h1>
          &nbsp;
          <a href="https://github.com/epost/purescript-grasp">epost/purescript-grasp</a>
        </div>
        <div class="column">
          <br/>
          <br/>
        </div>
      </div>
      <div class="columns">
        <div id="input-container" class="column">
          <textarea id="input-grasp">
          </textarea>
          <textarea id="input-stylesheet">
          </textarea>
        </div>
        <div id="output-container" class="column">
          <div id="output-graphviz-rendered" class="">
          </div>
          <pre id="output-graphviz-source">
          </pre>
        </div>
      </div>
    </div>

    <script src="grasp.js"></script>
    <script src="../node_modules/viz.js/viz.js"></script>
    <script src="../node_modules/viz.js/full.render.js"></script>
    <script>
      var input0 =
        "0 -succ-> 1\n" +
        "\n" +
        "x1->y1\n" +
        "x2 -> y2\n" +
        "x3-f3->y3\n" +
        "x4 -f4-> y4\n" +
        "x5 - f5 -> y5\n" +
        "x6:A -> y6:B\n" +
        "x7 : A -> y7 : B\n" +
        "x8:A -f8:AtoB-> y8:B\n" +
        "x9 : A - f9 : AtoB -> y9 : B\n" +
        "\n" +
        "f(x0a) -> f(x0b)\n" +
        "Array(123) -F(succ)-> Array(234)\n" +
        "\n" +
        "x10;x10->y10;y10->z10\n" +
        "x11\n" +
        "x11->y11\n" +
        "y11->z11\n" +
        "x12; x12->y12 ; y12->z12\n";

      var stylesheetSrc0 = "x11 { background: orange; }\nx12 { background: yellow; }\n";

      var graspInputElem = document.getElementById('input-grasp')
      var stylesheetInputElem = document.getElementById('input-stylesheet')
      var graphVizSourceElem = document.getElementById('output-graphviz-source')
      var graphVizRenderedElem = document.getElementById('output-graphviz-rendered')

      var viz = new Viz()

      function compile () {
        var graspSrc = graspInputElem.value.trim()
        var stylesheetSrc = stylesheetInputElem.value.trim()
        console.log('graspSrc =', graspSrc)
        console.log('stylesheet =', stylesheetSrc)
        var output = Grasp.CLI.compile('-g')(graspSrc)(stylesheetSrc)
        console.log('output =', output)
        graphVizSourceElem.innerHTML = output

        // render using viz.js, see using https://github.com/mdaines/viz.js/wiki/Usage
        viz.renderSVGElement(output).then(function (svgElem) {
          svgElem.setAttribute('width', '') // respect mah authoritay!
          svgElem.setAttribute('height', '')

          // update
          graphVizRenderedElem.innerHTML = ''
          graphVizRenderedElem.appendChild(svgElem)
        })
        .catch(error => {
          console.error(error)
        })
      }

      graspInputElem.value = input0
      stylesheetInputElem.value = stylesheetSrc0
      compile()

      graspInputElem.addEventListener('change', compile)
      graspInputElem.addEventListener('keyup', compile)
      stylesheetInputElem.addEventListener('change', compile)
      stylesheetInputElem.addEventListener('keyup', compile)
    </script>
  </body>
</html>
